<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-R">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Reasons Why I Love You</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:ital,wght@1,700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; height: 100%; margin: 0; overflow: hidden; }
        .font-paper { font-family: 'Playfair Display', serif; }
        @keyframes twinkle {
            0%,100%{opacity:0.7;box-shadow:0 0 4px 1px rgba(255,255,255,.7);}
            50%{opacity:1;box-shadow:0 0 8px 2px rgba(255,255,255,1);}
        }
        .star {position:absolute;background-color:white;border-radius:50%;animation:twinkle 4s infinite;}
        .heart-svg {width:100%;height:100%;}
        #grid-view-content {height:calc(100vh - 8rem);overflow-y:auto;}
        #grid-view-content::-webkit-scrollbar {display:none;}
        #grid-view-content {-ms-overflow-style:none;scrollbar-width:none;}
        #popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 192, 203, 0.95);
            color: white;
            font-weight: bold;
            padding: 1rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 50;
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        #cartoon-couple {
            position: absolute;
            bottom: 2%;           /* distance from bottom relative to screen */
            left: 2%;             /* distance from left relative to screen */
            width: 25vw;          /* 15% of viewport width */
            min-width: 100px;     /* optional: donâ€™t exceed 120px */
            height: auto;         /* maintain aspect ratio */ 
            pointer-events: none; /* stars/clicks pass through */
        }

    </style>
</head>
<body class="bg-gray-900 text-white h-full">
<div id="app" class="h-full">

    <!-- LOGIN -->
    <div id="login-view" class="h-full flex flex-col justify-center items-center p-4 md:p-8" style="display:none;">
        <div class="w-full max-w-sm text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-red-300 mb-6">100 Reasons Why I Love You</h1>
            <p class="text-gray-300 mb-4">Enter your secret passkey to unlock your story.</p>
            <input id="passkey-input" type="password" class="w-full bg-gray-800 border-2 border-gray-700 text-white rounded-lg px-4 py-3 text-center text-lg focus:outline-none focus:border-pink-500" placeholder="Your Secret Passkey">
            <button id="login-btn" class="mt-6 w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                Unlock
            </button>
            <p id="login-error" class="text-red-400 mt-4 h-6"></p>
        </div>
    </div>

    <!-- LOADING -->
    <div id="loading-view" class="h-full flex flex-col justify-center items-center p-4 md:p-8">
        <h1 id="loading-text" class="text-3xl md:text-4xl font-bold text-gray-300 animate-pulse">Initializing...</h1>
    </div>

    <!-- GRID -->
    <div id="grid-view" class="h-full flex flex-col p-4 md:p-8" style="display:none;">
        <header class="text-center mb-4">
            <h1 class="text-3xl md:text-4xl font-bold text-red-300">100 Reasons Why I Love You</h1>
        </header>
        <main id="grid-view-content" class="flex-1">
            <div id="grid-container" class="grid grid-cols-5 sm:grid-cols-10 gap-2 md:gap-4 max-w-4xl mx-auto"></div>
        </main>
        <footer class="text-center mt-4">
            <p class="text-gray-400">Click a heart to read a reason.</p>
            <p id="user-id" class="text-xs text-gray-600 mt-2"></p>
        </footer>
    </div>

    <!-- REASON -->
    <div id="reason-view" class="h-full flex-col justify-center items-center p-4" style="display:none;">
        <button id="back-to-grid-btn" class="absolute top-4 left-4 text-gray-300 hover:text-white transition duration-300">
            &larr; Back to Hearts
        </button>
        <div id="paper" class="text-gray-800 p-6 md:p-10 rounded-lg shadow-2xl max-w-lg w-full transform transition-all duration-500 scale-95 bg-white bg-cover bg-center"
             style="background-image:url('white-paper-texture.jpg');">
            <h2 id="reason-title" class="text-2xl md:text-3xl font-paper font-bold italic text-center mb-6">Reason #1</h2>
            <p id="reason-text" class="text-lg md:text-xl leading-relaxed text-center min-h-[100px]">This is a reason why I love you.</p>
        </div>
        <button id="to-sky-btn" class="mt-8 bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 transform hover:scale-105">
            Turn this into a star &rarr;
        </button>
    </div>

    <!-- NIGHT SKY -->
    <div id="sky-view" class="h-full" style="display:none;">
        
        <button id="back-to-reason-btn" class="absolute top-4 left-4 text-gray-300 hover:text-white transition duration-300 z-10">
            &larr; Back to Reason
        </button>
        <div class="absolute top-4 right-4 text-right z-10">
            <h2 class="text-2xl font-bold text-blue-200">Our Night Sky</h2>
            <p id="unlocked-count" class="text-blue-300">0 / 100 Stars</p>
        </div>
        <div id="sky-container" class="absolute inset-0 bg-gradient-to-b from-gray-900 to-black overflow-hidden"></div>
        <!-- Cartoon couple image -->
        <img id="cartoon-couple" src="cartoon-couple.png" alt="Couple watching stars" />

    </div>

    <div id="popup">Come back tomorrow ðŸ’•</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    let currentView = 'loading';
    let unlockedLevel = 1;
    let currentReasonIndex = -1;
    let reasons = [];
    let stars = [];
    let lastUnlockedTime = null;
    const LOCKOUT_SECONDS = 10;

    const loginView = document.getElementById('login-view');
    const passkeyInput = document.getElementById('passkey-input');
    const loginButton = document.getElementById('login-btn');
    const loginError = document.getElementById('login-error');
    const loadingView = document.getElementById('loading-view');
    const gridView = document.getElementById('grid-view');
    const reasonView = document.getElementById('reason-view');
    const skyView = document.getElementById('sky-view');
    const gridContainer = document.getElementById('grid-container');
    const reasonTitle = document.getElementById('reason-title');
    const reasonText = document.getElementById('reason-text');
    const skyContainer = document.getElementById('sky-container');
    const toSkyButton = document.getElementById('to-sky-btn');
    const backToGridButton = document.getElementById('back-to-grid-btn');
    const backToReasonButton = document.getElementById('back-to-reason-btn');
    const unlockedCountText = document.getElementById('unlocked-count');
    const paper = document.getElementById('paper');
    const popup = document.getElementById('popup');

    const TOTAL_HEARTS = 100;

    async function generateReasons() {
        try {
            const response = await fetch('reasons.txt');
            const text = await response.text();
            reasons = text.split('\n').filter(r => r.trim() !== '');
        } catch {
            reasons = Array.from({length:TOTAL_HEARTS},(_,i)=>`Reason #${i+1}`);
        }
        if (reasons.length < TOTAL_HEARTS) {
            for (let i = reasons.length; i < TOTAL_HEARTS; i++) reasons.push(`Reason #${i+1}`);
        }
    }

    function saveState() {
        const state = { unlockedLevel, stars };
        localStorage.setItem('loveAppProgress', JSON.stringify(state));
    }

    function loadState() {
        const saved = localStorage.getItem('loveAppProgress');
        if (saved) {
            const state = JSON.parse(saved);
            unlockedLevel = state.unlockedLevel || 1;
            stars = state.stars || [];
        }
    }

    function showPopup(msg) {
        popup.textContent = msg;
        popup.style.opacity = '1';
        setTimeout(()=>popup.style.opacity='0',2000);
    }

    function showView(viewName) {
        [loginView,loadingView,gridView,reasonView,skyView].forEach(v=>v.style.display='none');
        if(viewName==='login')loginView.style.display='flex';
        if(viewName==='loading')loadingView.style.display='flex';
        if(viewName==='grid')gridView.style.display='flex';
        if(viewName==='reason'){reasonView.style.display='flex';setTimeout(()=>paper.classList.add('scale-100','opacity-100'),100);}
        if(viewName==='sky'){skyView.style.display='block';renderSky();}
    }

    async function preloadHearts() {
        const promises=[];
        for(let i=1;i<=10;i++){
            promises.push(new Promise(res=>{
                const img=new Image();
                img.src=`handheart${i}.png`;
                img.onload=res;img.onerror=res;
            }));
        }
        await Promise.all(promises);
    }

    function initializeGrid(){
        gridContainer.innerHTML='';
        const heartsPerRow=10;
        for(let i=0;i<TOTAL_HEARTS;i++){
            const row=Math.floor(i/heartsPerRow);
            const col=i%heartsPerRow;
            const heartNum=row%2===0?col+1:heartsPerRow-col;
            const div=document.createElement('div');
            div.className='aspect-square relative flex items-center justify-center transition-all duration-300';
            div.id=`heart-${i}`;
            div.dataset.index=i;
            const img=document.createElement('img');
            img.src=`handheart${heartNum}.png`;
            img.className='w-full h-full object-contain transition-transform duration-300';
            const span=document.createElement('span');
            span.className='absolute font-bold text-sm md:text-base';
            span.textContent=i+1;
            div.append(img,span);
            updateHeartState(div,i);
            div.addEventListener('click',()=>onHeartClick(i));
            gridContainer.append(div);
        }
    }

    function updateHeartState(el,i){
        const n=i+1;const img=el.querySelector('img');const txt=el.querySelector('span');
        el.classList.remove('cursor-pointer','cursor-not-allowed','hover:opacity-80','hover:scale-105','opacity-50');
        img.classList.remove('animate-pulse');
        if(n<unlockedLevel){el.classList.add('cursor-pointer','hover:opacity-80','hover:scale-105');img.style.filter='brightness(1)';txt.classList.add('text-pink-100');}
        else if(n===unlockedLevel){el.classList.add('cursor-pointer','hover:opacity-80','hover:scale-105');img.classList.add('animate-pulse');txt.classList.add('text-red-100');}
        else{el.classList.add('opacity-50','cursor-not-allowed');img.style.filter='grayscale(100%) brightness(0.7)';txt.classList.add('text-gray-400');}
    }

    function updateAllHearts(){for(let i=0;i<TOTAL_HEARTS;i++){const el=document.getElementById(`heart-${i}`);if(el)updateHeartState(el,i);}}

    // --- navigation with lockout ---
    function onHeartClick(index){
        const n=index+1;if(n>unlockedLevel)return;
        currentReasonIndex=index;
        reasonTitle.textContent=`Reason #${n}`;
        reasonText.textContent=reasons[index];
        lastUnlockedTime=Date.now();
        showView('reason');
    }

    function onToSkyClick(){
        const n=currentReasonIndex+1;
        if(n===unlockedLevel){unlockedLevel++;addStar();saveState();updateAllHearts();}
        showView('sky');
    }

    function addStar(){
        stars.push({x:Math.random()*100,y:Math.random()*100,size:Math.random()*2+1.5,delay:Math.random()*4});
    }

    function renderSky(){
        skyContainer.innerHTML='';
        stars.forEach(star=>{
            const s=document.createElement('div');
            s.className='star';
            s.style.left=`${star.x}%`;s.style.top=`${star.y}%`;
            s.style.width=`${star.size}px`;s.style.height=`${star.size}px`;
            s.style.animationDelay=`${star.delay}s`;
            skyContainer.appendChild(s);
        });
        unlockedCountText.textContent=`${stars.length} / 100 Stars`;
    }

    function handleLogin(){
        const passkey=passkeyInput.value.trim();
        if(passkey==='250703'){
            showView('loading');
            setTimeout(()=>{loadState();initializeGrid();renderSky();showView('grid');},1000);
        }else loginError.textContent='Incorrect passkey.';
    }

    // back buttons
    backToGridButton.addEventListener('click',()=>{
        const now=Date.now();
        if(lastUnlockedTime&&now-lastUnlockedTime<LOCKOUT_SECONDS*1000){
            const remain=Math.ceil((LOCKOUT_SECONDS*1000-(now-lastUnlockedTime))/1000);
            showPopup(`Come back in ${remain}s ðŸ’•`);
            return;
        }
        showView('grid');
    });

    backToReasonButton.addEventListener('click',()=>showView('reason'));

    async function init(){
        loginButton.addEventListener('click',handleLogin);
        passkeyInput.addEventListener('keypress',e=>{if(e.key==='Enter')handleLogin();});
        toSkyButton.addEventListener('click',onToSkyClick);
        await preloadHearts();await generateReasons();
        showView('login');
    }

    init();
});
</script>
</body>
</html>
